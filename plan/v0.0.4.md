# VSCode Semantic Search Extension - v0.0.4

## Overview

Add a dedicated **Semantic Search sidebar** in the Activity Bar, similar to VS Code's built-in Search sidebar. This provides a dedicated UI for semantic search queries with input fields, filters, and inline results display.

## Goals

- **Add Activity Bar icon** with dedicated Semantic Search view container
- **Create WebviewViewProvider** for search input UI with:
  - Query input field
  - Files to include filter
  - Files to exclude filter
  - Search button
- **Display results inline** in the sidebar
- **Support opening full Search Results Panel** for richer viewing experience
- **Maintain existing functionality** - Index sidebar remains in Explorer

## UI Design

### Sidebar Layout (Similar to VS Code Search)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEMANTIC SEARCH                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ” Ask a question...            â”‚ â”‚  <- Query input
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â–¸ files to include                  â”‚  <- Collapsible
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ e.g. src/**/*.ts            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚ â–¸ files to exclude                  â”‚  <- Collapsible
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ e.g. node_modules/**        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚ [Search] [Open in Panel â†—]          â”‚  <- Action buttons
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RESULTS (5 matches)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ src/services/searchService.ts    â”‚
â”‚    Lines 45-67 (92%)                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ async search(query: ...   â”‚    â”‚  <- Code preview
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ ğŸ“„ src/commands/search.ts           â”‚
â”‚    Lines 12-34 (87%)                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ export function regis...  â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ ... more results                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key UI Elements

1. **Query Input**: Large text input for semantic questions
2. **Files to Include**: Glob pattern input (optional, collapsible)
3. **Files to Exclude**: Glob pattern input (optional, collapsible)
4. **Search Button**: Triggers search
5. **Open in Panel Button**: Opens SearchResultsPanel for full view
6. **Results Section**: Inline display of search results with:
   - File path and icon
   - Line range and relevance score
   - Code snippet preview
   - Click to open file at location

---

## Architecture

### New Files

```
src/
  views/
    searchSidebar.ts          # New WebviewViewProvider for search sidebar
```

### Modified Files

```
package.json                  # Add viewsContainers, views, commands
src/extension.ts              # Register new sidebar view provider
```

### Component Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SearchSidebarProvider         â”‚
â”‚         (WebviewViewProvider)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - resolveWebviewView()                   â”‚
â”‚ - _getHtmlContent()                      â”‚
â”‚ - _handleMessage()                       â”‚
â”‚ - _performSearch()                       â”‚
â”‚ - _updateResults()                       â”‚
â”‚ - _openInPanel()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ uses
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SearchService                 â”‚
â”‚           (existing)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Plan

### Phase 1: Package.json Configuration

#### 1.1 Add View Container (Activity Bar)

```json
"viewsContainers": {
  "activitybar": [
    {
      "id": "semanticSearch",
      "title": "Semantic Search",
      "icon": "$(search-fuzzy)"
    }
  ]
}
```

#### 1.2 Add Views

```json
"views": {
  "semanticSearch": [
    {
      "type": "webview",
      "id": "semanticSearchSidebar",
      "name": "Search",
      "icon": "$(search)",
      "contextualTitle": "Semantic Search"
    }
  ],
  "explorer": [
    {
      "id": "semanticSearchIndex",
      "name": "Semantic Search Index",
      "icon": "$(search)",
      "contextualTitle": "Semantic Search Index"
    }
  ]
}
```

#### 1.3 Add Commands

```json
{
  "command": "semantic-search.focusSearchInput",
  "title": "Focus Search Input",
  "category": "Semantic Search",
  "icon": "$(search)"
},
{
  "command": "semantic-search.clearSearchResults",
  "title": "Clear Search Results",
  "category": "Semantic Search",
  "icon": "$(clear-all)"
},
{
  "command": "semantic-search.openSearchInPanel",
  "title": "Open Search in Panel",
  "category": "Semantic Search",
  "icon": "$(link-external)"
}
```

#### 1.4 Add Keybindings

```json
"keybindings": [
  {
    "command": "semantic-search.focusSearchInput",
    "key": "ctrl+shift+s",
    "mac": "cmd+shift+s"
  }
]
```

### Phase 2: Create SearchSidebarProvider

#### 2.1 Class Structure

```typescript
// src/views/searchSidebar.ts

import * as vscode from 'vscode';
import { SearchService } from '../services/searchService';
import { SearchResult } from '../models/types';
import { SearchResultsPanel } from './searchResultsPanel';

export class SearchSidebarProvider implements vscode.WebviewViewProvider {
    public static readonly viewType = 'semanticSearchSidebar';
    
    private _view?: vscode.WebviewView;
    private _searchService: SearchService;
    private _extensionUri: vscode.Uri;
    private _lastResults: SearchResult[] = [];
    private _lastQuery: string = '';

    constructor(
        extensionUri: vscode.Uri,
        searchService: SearchService
    ) { ... }

    public resolveWebviewView(
        webviewView: vscode.WebviewView,
        context: vscode.WebviewViewResolveContext,
        _token: vscode.CancellationToken
    ): void { ... }

    public focusSearchInput(): void { ... }
    public clearResults(): void { ... }
    public openInPanel(): void { ... }

    private _getHtmlContent(webview: vscode.Webview): string { ... }
    private _handleMessage(message: any): void { ... }
    private async _performSearch(
        query: string, 
        includePattern?: string, 
        excludePattern?: string
    ): Promise<void> { ... }
}
```

#### 2.2 HTML Template Structure

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        /* VS Code theme-aware styling */
        body { 
            font-family: var(--vscode-font-family);
            color: var(--vscode-foreground);
            background: var(--vscode-sideBar-background);
            padding: 0;
            margin: 0;
        }
        .search-container { padding: 8px; }
        .input-group { margin-bottom: 8px; }
        .search-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--vscode-input-border);
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border-radius: 2px;
        }
        .filter-section { margin-top: 8px; }
        .filter-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 11px;
            text-transform: uppercase;
        }
        .results-container { margin-top: 12px; }
        .result-item {
            padding: 8px;
            border-bottom: 1px solid var(--vscode-panel-border);
            cursor: pointer;
        }
        .result-item:hover {
            background: var(--vscode-list-hoverBackground);
        }
        /* ... more styles ... */
    </style>
</head>
<body>
    <div class="search-container">
        <!-- Search Input -->
        <div class="input-group">
            <input type="text" 
                   class="search-input" 
                   id="queryInput" 
                   placeholder="Ask a question...">
        </div>
        
        <!-- Files to Include -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilter('include')">
                <span class="codicon codicon-chevron-right" id="includeChevron"></span>
                <span>files to include</span>
            </div>
            <div class="filter-content" id="includeContent" style="display:none;">
                <input type="text" 
                       class="search-input" 
                       id="includeInput" 
                       placeholder="e.g. src/**/*.ts">
            </div>
        </div>
        
        <!-- Files to Exclude -->
        <div class="filter-section">
            <div class="filter-header" onclick="toggleFilter('exclude')">
                <span class="codicon codicon-chevron-right" id="excludeChevron"></span>
                <span>files to exclude</span>
            </div>
            <div class="filter-content" id="excludeContent" style="display:none;">
                <input type="text" 
                       class="search-input" 
                       id="excludeInput" 
                       placeholder="e.g. **/test/**">
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="button-group">
            <button id="searchBtn" class="primary-button">Search</button>
            <button id="openPanelBtn" class="secondary-button" title="Open in Panel">
                <span class="codicon codicon-link-external"></span>
            </button>
        </div>
    </div>
    
    <!-- Results Section -->
    <div class="results-container" id="resultsContainer">
        <!-- Results will be rendered here -->
    </div>
    
    <script>
        const vscode = acquireVsCodeApi();
        
        // Handle search
        document.getElementById('searchBtn').addEventListener('click', () => {
            const query = document.getElementById('queryInput').value;
            const include = document.getElementById('includeInput').value;
            const exclude = document.getElementById('excludeInput').value;
            
            vscode.postMessage({
                command: 'search',
                query,
                includePattern: include,
                excludePattern: exclude
            });
        });
        
        // Handle Enter key in query input
        document.getElementById('queryInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('searchBtn').click();
            }
        });
        
        // Handle open in panel
        document.getElementById('openPanelBtn').addEventListener('click', () => {
            vscode.postMessage({ command: 'openInPanel' });
        });
        
        // Handle messages from extension
        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.command) {
                case 'updateResults':
                    renderResults(message.results);
                    break;
                case 'showLoading':
                    showLoading();
                    break;
                case 'focusInput':
                    document.getElementById('queryInput').focus();
                    break;
            }
        });
        
        function renderResults(results) { ... }
        function showLoading() { ... }
        function toggleFilter(name) { ... }
    </script>
</body>
</html>
```

### Phase 3: Integration

#### 3.1 Register in extension.ts

```typescript
// In activate()
import { SearchSidebarProvider } from './views/searchSidebar';

// Register search sidebar webview provider
const searchSidebarProvider = new SearchSidebarProvider(
    context.extensionUri,
    searchService
);

context.subscriptions.push(
    vscode.window.registerWebviewViewProvider(
        SearchSidebarProvider.viewType,
        searchSidebarProvider,
        { webviewOptions: { retainContextWhenHidden: true } }
    )
);

// Register focus command
context.subscriptions.push(
    vscode.commands.registerCommand('semantic-search.focusSearchInput', () => {
        vscode.commands.executeCommand('semanticSearchSidebar.focus');
        searchSidebarProvider.focusSearchInput();
    })
);

// Register clear command
context.subscriptions.push(
    vscode.commands.registerCommand('semantic-search.clearSearchResults', () => {
        searchSidebarProvider.clearResults();
    })
);

// Register open in panel command
context.subscriptions.push(
    vscode.commands.registerCommand('semantic-search.openSearchInPanel', () => {
        searchSidebarProvider.openInPanel();
    })
);
```

#### 3.2 Update SearchService (if needed)

Add support for include/exclude patterns in search:

```typescript
// In SearchService
async search(
    query: string, 
    workspacePath: string, 
    maxResults?: number,
    options?: {
        includePattern?: string;
        excludePattern?: string;
    }
): Promise<SearchResult[]> {
    // Filter results based on patterns
    let results = await this._vectorDb.search(query, maxResults);
    
    if (options?.includePattern) {
        results = results.filter(r => minimatch(r.filePath, options.includePattern!));
    }
    
    if (options?.excludePattern) {
        results = results.filter(r => !minimatch(r.filePath, options.excludePattern!));
    }
    
    return results;
}
```

---

## Package.json Changes Summary

```json
{
  "contributes": {
    "viewsContainers": {
      "activitybar": [
        {
          "id": "semanticSearch",
          "title": "Semantic Search",
          "icon": "$(search-fuzzy)"
        }
      ]
    },
    "views": {
      "semanticSearch": [
        {
          "type": "webview",
          "id": "semanticSearchSidebar",
          "name": "Search",
          "contextualTitle": "Semantic Search"
        }
      ],
      "explorer": [
        {
          "id": "semanticSearchIndex",
          "name": "Semantic Search Index",
          "icon": "$(search)",
          "contextualTitle": "Semantic Search Index"
        }
      ]
    },
    "commands": [
      // ... existing commands ...
      {
        "command": "semantic-search.focusSearchInput",
        "title": "Focus Search Input",
        "category": "Semantic Search"
      },
      {
        "command": "semantic-search.clearSearchResults",
        "title": "Clear Search Results",
        "category": "Semantic Search",
        "icon": "$(clear-all)"
      },
      {
        "command": "semantic-search.openSearchInPanel",
        "title": "Open Search in Panel",
        "category": "Semantic Search",
        "icon": "$(link-external)"
      }
    ],
    "menus": {
      "view/title": [
        // ... existing menus ...
        {
          "command": "semantic-search.clearSearchResults",
          "when": "view == semanticSearchSidebar",
          "group": "navigation@1"
        },
        {
          "command": "semantic-search.openSearchInPanel",
          "when": "view == semanticSearchSidebar",
          "group": "navigation@2"
        }
      ]
    },
    "keybindings": [
      {
        "command": "semantic-search.focusSearchInput",
        "key": "ctrl+shift+s",
        "mac": "cmd+shift+s"
      }
    ]
  }
}
```

---

## Features

### Core Features

| Feature | Description | Priority |
|---------|-------------|----------|
| Activity Bar Icon | Dedicated icon in Activity Bar | P0 |
| Search Input | Text input for semantic queries | P0 |
| Include Filter | Glob pattern for files to include | P1 |
| Exclude Filter | Glob pattern for files to exclude | P1 |
| Inline Results | Display results in sidebar | P0 |
| Open in Panel | Button to open SearchResultsPanel | P1 |
| Keyboard Shortcut | Ctrl+Shift+S to focus search | P1 |
| Result Click | Click result to open file | P0 |

### UX Enhancements

| Feature | Description | Priority |
|---------|-------------|----------|
| Loading Indicator | Show spinner during search | P1 |
| Result Count | Show number of matches | P1 |
| Code Preview | Show snippet of matching code | P1 |
| Relevance Score | Show match percentage | P2 |
| File Icons | Show file type icons | P2 |
| Collapsible Filters | Toggle include/exclude sections | P2 |
| Search History | Remember recent queries | P3 |

---

## Testing Plan

### Unit Tests

1. Test SearchSidebarProvider initialization
2. Test message handling (search, openInPanel, etc.)
3. Test include/exclude pattern filtering
4. Test HTML generation

### Integration Tests

1. Test sidebar registration and visibility
2. Test search execution from sidebar
3. Test result rendering
4. Test file opening from results
5. Test Open in Panel functionality

### Manual Testing

1. Verify Activity Bar icon appears
2. Test search input responsiveness
3. Verify include/exclude filters work
4. Check results display correctly
5. Test click-to-open functionality
6. Verify keyboard shortcut works
7. Test Open in Panel button

---

## Migration Notes

- No breaking changes to existing functionality
- Index sidebar remains in Explorer panel
- New search sidebar is additive feature
- Existing search commands still work

---

## Future Enhancements (v0.0.5+)

1. **Search History**: Dropdown with recent queries
2. **Saved Searches**: Save frequently used search/filter combinations
3. **Result Grouping**: Group results by file or folder
4. **Quick Actions**: Copy code, copy path from results
